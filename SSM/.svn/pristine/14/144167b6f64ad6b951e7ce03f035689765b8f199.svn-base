package com.huiji.service;

import java.util.Collection;
import java.util.Date;
import java.util.Iterator;
import java.util.List;

import javax.annotation.Resource;

import org.springframework.stereotype.Service;

import com.huiji.mapper.OrdersMapper;
import com.huiji.po.Cart;
import com.huiji.po.CartItem;
import com.huiji.po.Orderdetail;
import com.huiji.po.Orders;
import com.huiji.po.PageBean;
import com.huiji.po.User;

@Service
public class OrdersService {
	@Resource
	public OrdersMapper ordersMapper;
	
	public List<Orders> findOrdersList(){
		return ordersMapper.findOrdersList();
	}
	
	public List<Orders> findOrdersAndUserList(){
		return ordersMapper.findOrdersAndUserList();
	}
	
	public List<Orders> findOrderDetailAndUserList(){
		return ordersMapper.findOrderDetailAndUserList();
	}
	
	public List<User> findUserBuyItems(){
		return ordersMapper.findUserBuyItems();
	}
	
	//用户购买商品，插入订单  插入订单后，生成订单明细
	public void createOrders(Cart cart,User user){
		//创建id
		long order_id = ordersMapper.getOrderId();
		//创建订单
		Orders order = new Orders();
		order.setCreatetime(new Date());
		order.setId(order_id);
		order.setNote("暂无说明");
		order.setS_number(1);
		order.setUser_id(user.getId());
		ordersMapper.buyItems(order);
		//生成订单明细
		Orderdetail orderdetail = new Orderdetail();
		Collection<CartItem> cartItem = cart.getCartItem();
		Iterator<CartItem> it = cartItem.iterator();
		while (it.hasNext()) {
			CartItem item = it.next();
			Long id = item.getItems().getId();
			orderdetail.setItems_id(id);
			orderdetail.setOrders_id(order_id);
			orderdetail.setItems_num(cartItem.size());
		}
		ordersMapper.addOrderDetail(orderdetail);
	}
	
	public List<Orders> findOrderListByOrder(long id){
		return ordersMapper.findOrderListByOrder(id);
	}
	
	public int getOrderCount(){
		return ordersMapper.getOrderCount();
	}
	
	public List<Orders> findOrderList(PageBean pageBean){
		return ordersMapper.findOrderList(pageBean);
	}
}
